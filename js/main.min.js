$((function(){var clanData,beginIndex=0,stepLength=20,endingIndex=beginIndex+20-1,dataIndex=beginIndex,overflowIndex=0,overflowStep=0,fileExtList={1:"png",2:"jpg",3:"jpeg"},repeated_desc;function fetchData(){if(restorePosition(),void 0===clanData)return!1;var total_entries=clanData.length;info("收录",total_entries),function judgePage(){beginIndex<=0?$(".flipBtn.prev").hide():$(".flipBtn.prev").show(),endingIndex>=total_entries-1?$(".flipBtn.next").hide():$(".flipBtn.next").show()}(),function loadList(){for($("#content tbody").empty(),beginIndex<0&&(endingIndex=(beginIndex=0)+20-1),endingIndex>total_entries-1&&(overflowStep=(overflowIndex=endingIndex)-(endingIndex=total_entries-1)),0!=overflowStep&&(endingIndex+=overflowStep,overflowStep=0);dataIndex>=beginIndex&&dataIndex<=endingIndex;){if(insertData(clanData,dataIndex,"table"),!(dataIndex<total_entries-1))return;dataIndex++}}()}function slideDownNotification(){setTimeout((function(){$("#notification_zone").slideDown(250)}),450)}function restoreDetailWindow(){window.history.replaceState({Page:1},"","./"),$("#detail .inner").animate({height:"0"},500),$("#detail").fadeOut(600,(function(){$("#detail .content").empty()})),document.title="闪击战ID大百科",$('meta[name="description"]').attr("content","本网页旨在帮助国服玩家刊载军团简介。有意见或建议请加Q群：715200589")}function startSearching(){$("#searchstr").val()?(window.history.pushState({Page:2},"","?keyword="+$("#searchstr").val()),restorePosition(),getClanData()):alert("您还没有输入关键词！")}function slideUpNotification(){"none"!=$("#notification_zone").css("display")&&$("#notification_zone").slideUp(250)}function getClanData(mode,id){if(mode){if("byId"==mode){var id=id,detail;if(1==isNaN(Number(id)))detail=toCompare(id,clanData,"private");else{if(0==(id=Number(id))||id%1!=0)return;detail=toCompare(id,clanData,"id")}let len;if(0==detail.length)return;insertData(detail,0,"detail"),document.title="["+detail[0].Tag+"]"+detail[0].Full+"——闪击战ID百科",detail[0].Desc?$('meta[name="description"]').attr("content",detail[0].Desc):$('meta[name="description"]').attr("content","本网页旨在帮助国服玩家刊载军团简介。有意见或建议请加Q群：715200589"),showDetail()}}else{var keyword=getQueryStr("keyword");if(""==keyword)return;$("#content tbody").empty();let result=toCompare(keyword,clanData),resultCount=result.length;0==resultCount&&insertData(),info("搜索",resultCount);for(let i in result)insertData(result,i,"table");let backIcon='<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></svg>';slideUpNotification(),$(".flipBtn").hide(),$("#register-banner").prepend('<span class="btn flipBtn back">'+backIcon+"返回</span>"),$(".flipBtn.back").show()}}function getClanFamily(i){var parentClan;let result=toCompare(i,clanData,"mid"),resultCount=result.length;$("#detail .content").append('<div class="clanFamily"><h3>相关军团</h3></div>');for(let i in result)insertData(result,i,"mid")}function toCompare(keyword,data,mode){switch(keyword){case!keyword:break;default:let filter=["\\[","\\]","\\{","\\}","\\(","\\)","\\+","\\*","\\/"];if(isNaN(Number(keyword)))for(let i in keyword)for(let j in filter)filtSpecial=new RegExp(filter[j],"g"),keyword=keyword.replace(filtSpecial,filter[j]);var strictReg=new RegExp("^"+keyword+"$")}if(data instanceof Array){var len=data.length,arr=[],reg=new RegExp(keyword,"i");switch(mode){case"id":for(let i=0;i<len;i++)String(data[i].ID).match(strictReg)&&arr.push(data[i]);break;case"mid":for(let i=0;i<len;i++)String(data[i].MID).match(strictReg)&&arr.push(data[i]);break;case"private":for(let i=0;i<len;i++)String(data[i].Tag).match(strictReg)&&arr.push(data[i]);break;case"analysis":let z=0;for(let i=0;i<len;i++)String(data[i].Desc).length>10&&!String(data[i].Desc).match(/编者/g)&&String(data[i].Desc).match(/\d/g)&&(arr.push(data[i]),z++);break;default:for(let i=0;i<len;i++)(String(data[i].Tag).match(reg)||String(data[i].Full).match(reg)||String(data[i].ID).match(strictReg||reg))&&arr.push(data[i])}return arr}}function info(action,number){$(".info .action").html(action),$(".info .total_entries").html(number)}function insertData(d,i,method){if(!d)return void $("#content tbody").append("<tr><td>未搜索到相关内容，相关军团可能未被收录</td></tr>");var ID=d[i=i||0].ID,Tag=d[i].Tag,Full=d[i].Full,tableID;if(d[i].hasOwnProperty("Desc"))var Desc=d[i].Desc;else Desc="无";if(d[i].hasOwnProperty("MID"))var MID=d[i].MID;if(d[i].hasOwnProperty("Logo"))var logoExt=d[i].Logo;let insertHTML;switch(method){case"table":repeatedDesc(MID,Desc),repeated_desc&&(Desc=repeated_desc),Desc.length>20&&(Desc=Desc.substr(0,19)+"…"),insertHTML="<tr data-clan-id="+(tableID=1==isNaN(ID)?Tag:ID)+"><td>"+ID+"</td><td>["+Tag+"] "+Full+"</td><td>"+Desc+"</td></tr>",$("#content tbody").append(insertHTML),repeated_desc="";break;case"detail":var logoURL='img src="./img/assets/default_clan_logo.svg"',imgDisplay="",clanBrief,clanIntro;if(d[i].hasOwnProperty("Imgs"))var imgList=d[i].Imgs;if(logoExt&&(logoURL='img src="img/clan/'+ID+"/0."+fileExtList[logoExt]+'"'),d[i].Date)var Estbl=processDate(d[i].Date);else Estbl="--";if(imgList){imgDisplay='<div class="clan-img"><div class = "container">';for(let i=0;i<imgList.length;i++)imgDisplay+='<li><img src="./img/clan/'+ID+"/"+(i+1)+"."+fileExtList[imgList[i]]+'"></li>';imgDisplay+="</div></div>"}repeatedDesc(MID,Desc),repeated_desc&&(Desc=repeated_desc),insertHTML='<div class="clanInfo"><div class="logo"> <'+logoURL+' alt="['+Tag+"]+"+Full+'Logo"></div><div class="info"><p class="tag">['+Tag+"] "+Full+"</p><p>ID："+ID+"</p><p>创建日期："+Estbl+"</p></div></div>"+imgDisplay+('<div class="introduction"><h3>简介</h3><p>'+(Desc=Desc.replace(/\n/g,"</p><p>"))+"</p></div>"),$("#detail .content").append(insertHTML),MID&&getClanFamily(MID),repeated_desc="";break;case"mid":let beginMark='<div data-clan-id="'+ID+'">';insertHTML='<span class="tag">['+Tag+"] "+Full+'</span><span class="idNumber">ID：'+ID+"</span>";let endMark="</div>";ID==getQueryStr("cid")&&(beginMark='<div data-clan-id="'+ID+'"class ="current">'),insertHTML=[beginMark,insertHTML,endMark].join(""),$("#detail .clanFamily").append(insertHTML)}}function removeInput(t){$(t).val("")}function calcTableHeight(){return tablePosition=$(window).height()-$("table thead").outerHeight()-$("#content #register-banner").outerHeight()-$("#head").outerHeight(),$("table tbody").css({height:tablePosition+"px"}),tablePosition}function getQueryStr(n){let reg=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),result=window.location.search.substr(1).match(reg);if(!result)return;let decodeR=decodeURIComponent(result[2]);return decodeR?null!=result?decodeR:null:void 0}function restorePosition(){$("table tbody").animate({scrollTop:0},500)}function showDetail(){$("#detail .inner").animate({height:"100%"},450),$("#detail").fadeIn(400)}function processDate(rd){let rDate=rd,processedDate,result;return date=new Date,date.setFullYear(1900),date.setMonth(0),date.setDate(rDate-1),[date.getFullYear(),Number(date.getMonth()+1),date.getDate()].join("-")}function repeatedDesc(MID,Desc){var reID=/\/repeat(\(([^)]*)\))?/;return Desc.match(reID)?(Desc.match(reID)[2]&&(MID=Desc.match(reID)[2]),repeated_desc=toCompare(MID,clanData,"id"),repeated_desc=Desc.replace(reID,repeated_desc[0].Desc)):null}$.ajaxSetup({async:!1}),$.ajax({url:"./js/clan.json",dataType:"json",error:function(){console.log("数据获取失败")},success:function(data){clanData=data}}),calcTableHeight(),$(window).resize((function(){calcTableHeight()})),getClanData("byId",getQueryStr("cid")),getQueryStr("keyword")?(getClanData(),$("#searchstr").val(getQueryStr("keyword"))):fetchData(),$(document).on("click",".flipBtn.back",(function(){dataIndex=beginIndex,$(".flipBtn").show(),$(".flipBtn.back").hide(),window.history.replaceState({Page:1},"","./"),fetchData()})),$(".flipBtn.next").on("click",(function(){endingIndex+=20,dataIndex=beginIndex+=20,fetchData()})),$(".flipBtn.prev").on("click",(function(){endingIndex+=-20,dataIndex=beginIndex+=-20,fetchData()})),$(document).on("keydown",(function(e){var keyFind=e.which;(e.ctrlKey&&70==keyFind||e.metaKey&&70==keyFind)&&(e.preventDefault(),$("#searchstr").focus())})),$("#search_btn").on("click",(function(){""!=$("#searchstr").val()&&startSearching()})),$(".btn.resetBtn>*").on("click",(function(){removeInput("#searchstr"),$("#searchstr").focus()})),$("#searchstr").on("click",(function(){$("#searchstr").is(":focus")&&$("#notification_zone").slideDown(250)})),$("#searchstr").on("keydown",(function(e){var key;13==e.which&&startSearching()})),$(document).on("click",(function(e){var target=$(e.target);(!target.is("#searchstr")&&!target.is("#notification_zone .wrap")&&!target.is("#notification_zone .wrap *")||target.is("#notification_zone .toCollapse")||target.is("#notification_zone .toCollapse *"))&&slideUpNotification()})),$(document).on("click","#content tbody tr",(function(){let cid=$(this).attr("data-clan-id");window.history.pushState({Page:3},"","?cid="+cid),getClanData("byId",getQueryStr("cid")),showDetail()})),$(document).on("mousedown","#content tbody tr",(function(e){1==e.which&&$(this).css({"background-color":"rgba(70, 94, 109, 0.5)"})})),$(document).on("mouseup","#content tbody tr",(function(){$(this).removeAttr("style")})),$(document).on("click","#detail .clanFamily [data-clan-id]",(function(){let cid=$(this).attr("data-clan-id");window.history.pushState({Page:4},"","?cid="+cid),$("#detail .content").fadeOut(250),setTimeout((function(){$("#detail .content>*").remove(),getClanData("byId",getQueryStr("cid"))}),200),showDetail(),$("#detail .content").fadeIn(350)})),$("#detail").on("click",(function(e){let target=$(e.target);target.is("#detail .inner *")&&!target.is("#detail .dismissBtn *")||restoreDetailWindow()}));var indexList=new Array,recommendList=toCompare(void 0,clanData,"analysis");for(let i=0;i<indexList.length;i++)console.log(recommendList[indexList[i]]);function randomNum(){var rand=parseInt(Math.random()*recommendList.length+1);for(let i;i<indexList.length;i++)if(rand==indexList[i])return!1;indexList.push(rand)}function showRecomend(){do{randomNum()}while(indexList.length<5)}}));